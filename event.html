<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Event</title>
<style>
    :root {
        --bg-gradient: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
        --text-color: #e0e0e0;
        --card-bg: rgba(255, 255, 255, 0.05);
        --card-border: rgba(255, 255, 255, 0.08);
        --input-bg: rgba(255, 255, 255, 0.1);
        --input-focus-bg: rgba(255, 255, 255, 0.15);
        --preview-bg: rgba(139, 92, 246, 0.15);
        --preview-date-color: #c4b5fd;
        --cal-btn-bg: rgba(255, 255, 255, 0.1);
        --cal-btn-hover: rgba(255, 255, 255, 0.2);
    }

    [data-theme="light"] {
        --bg-gradient: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
        --text-color: #102a43;
        --card-bg: rgba(255, 255, 255, 0.6);
        --card-border: rgba(0, 0, 0, 0.05);
        --input-bg: rgba(0, 0, 0, 0.05);
        --input-focus-bg: rgba(0, 0, 0, 0.08);
        --preview-bg: rgba(139, 92, 246, 0.1);
        --preview-date-color: #7c3aed;
        --cal-btn-bg: rgba(0, 0, 0, 0.05);
        --cal-btn-hover: rgba(0, 0, 0, 0.1);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html {
        background: var(--bg-gradient);
        color: var(--text-color);
        min-height: 100vh;
        transition: background 0.3s, color 0.3s;
    }

    body {
        padding: 20px;
        font: 16px/1.5 system-ui;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
    }

    .header-bar {
        display: flex;
        align-items: center;
        width: 100%;
        max-width: 450px;
        margin-bottom: 24px;
    }

    .home-link {
        text-decoration: none;
        font-size: 20px;
        margin-right: 16px;
        opacity: 0.7;
        transition: opacity 0.2s;
    }

    .home-link:hover {
        opacity: 1;
    }

    h1 {
        flex: 1;
        text-align: center;
        margin: 0;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .theme-toggle {
        background: transparent;
        border: none;
        cursor: pointer;
        font-size: 20px;
        padding: 0 0 0 16px;
        opacity: 0.7;
        transition: opacity 0.2s;
    }

    .theme-toggle:hover {
        opacity: 1;
        transform: scale(1.1);
    }

    .card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 20px;
        padding: 24px;
        width: 100%;
        max-width: 450px;
        margin-bottom: 16px;
    }

    .card h2 {
        font-size: 14px;
        opacity: 0.7;
        margin-bottom: 12px;
    }

    input,
    textarea {
        width: 100%;
        padding: 14px;
        border: none;
        border-radius: 12px;
        background: var(--input-bg);
        color: inherit;
        font: inherit;
        margin-bottom: 12px;
    }

    input:focus,
    textarea:focus {
        outline: none;
        background: var(--input-focus-bg);
    }

    textarea {
        height: 80px;
        resize: vertical;
    }

    .date-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }

    button {
        width: 100%;
        padding: 14px;
        border: none;
        border-radius: 12px;
        font: inherit;
        font-weight: 600;
        cursor: pointer;
        background: linear-gradient(135deg, #8b5cf6, #22c55e);
        color: white;
        margin-bottom: 12px;
    }

    button:hover {
        opacity: 0.9;
    }

    .preview {
        padding: 20px;
        background: var(--preview-bg);
        border-radius: 16px;
        text-align: center;
    }

    .preview-title {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 8px;
    }

    .preview-date {
        font-size: 18px;
        color: var(--preview-date-color);
        margin-bottom: 4px;
    }

    .preview-time {
        opacity: 0.7;
    }

    .preview-desc {
        font-size: 14px;
        opacity: 0.7;
        margin-top: 12px;
    }

    .countdown {
        font-size: 32px;
        font-weight: 700;
        color: #22c55e;
        margin: 16px 0;
    }

    .countdown-label {
        font-size: 12px;
        opacity: 0.5;
    }

    .add-to-cal {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 16px;
    }

    .cal-btn {
        flex: 1;
        min-width: 120px;
        padding: 10px;
        background: var(--cal-btn-bg);
        border: none;
        border-radius: 8px;
        color: inherit;
        font: inherit;
        font-size: 13px;
        cursor: pointer;
        text-decoration: none;
        text-align: center;
    }

    .cal-btn:hover {
        background: var(--cal-btn-hover);
    }

    .toast {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        padding: 8px 16px;
        background: #22c55e;
        color: white;
        border-radius: 20px;
        font-size: 14px;
        opacity: 0;
        transition: all 0.3s;
        pointer-events: none;
    }

    .toast.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }
</style>

<div class="header-bar">
    <a href="index.html" class="home-link" title="Home">üè†</a>
    <h1>üìÖ Event</h1>
    <button class="theme-toggle" id="theme-toggle" title="Toggle theme">üåì</button>
</div>

<div class="card" id="editor-view">
    <h2>Create event</h2>
    <input type="text" id="title" placeholder="Event title">
    <div class="date-row">
        <input type="date" id="date">
        <input type="time" id="time" value="18:00">
    </div>
    <textarea id="desc" placeholder="Description (optional)"></textarea>
    <button id="create">üìÖ Create & Share</button>
    <button id="clear">üßπ Clear</button>
</div>

<div class="card" id="preview-view" style="display:none">
    <div class="preview">
        <div class="preview-title" id="p-title"></div>
        <div class="preview-date" id="p-date"></div>
        <div class="preview-time" id="p-time"></div>
        <div class="countdown" id="countdown"></div>
        <div class="countdown-label" id="countdown-label"></div>
        <div class="preview-desc" id="p-desc"></div>
    </div>
    <div class="add-to-cal">
        <a class="cal-btn" id="gcal" target="_blank">üìÜ Google</a>
        <a class="cal-btn" id="ical" download="event.ics">üì• iCal</a>
        <button class="cal-btn" id="share">üîó Copy Link</button>
    </div>
</div>

<div class="toast" id="toast"></div>

<footer style="text-align:center; margin-top:40px; padding:20px; opacity:0.5; font-size:12px;">
    <a href="https://shogun-eco.xyz" target="_blank" style="color:inherit;text-decoration:none;">shogun-eco.xyz</a>
</footer>

<script>
    const toast = document.getElementById('toast')
    document.getElementById('date').valueAsDate = new Date()

    // Theme logic
    const themeToggle = document.getElementById('theme-toggle');
    const storedTheme = localStorage.getItem('theme');
    if (storedTheme) {
        document.documentElement.setAttribute('data-theme', storedTheme);
    } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
        document.documentElement.setAttribute('data-theme', 'light');
    }
    themeToggle.addEventListener('click', () => {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
    });    // Check for shared event
    if (location.hash.length > 1) loadEvent()

    document.getElementById('create').addEventListener('click', createEvent)
    document.getElementById('share').addEventListener('click', async () => {
        try { await navigator.clipboard.writeText(location.href); showToast('Link copied!') } catch { }
    })
    document.getElementById('clear').addEventListener('click', () => {
        document.getElementById('title').value = ''
        document.getElementById('date').valueAsDate = new Date()
        document.getElementById('time').value = '18:00'
        document.getElementById('desc').value = ''
        history.replaceState({}, '', location.pathname)
    })

    async function createEvent() {
        const title = document.getElementById('title').value || 'Evento'
        const date = document.getElementById('date').value
        const time = document.getElementById('time').value
        const desc = document.getElementById('desc').value
        if (!date) { showToast('Select a date'); return }

        const data = { title, date, time, desc }
        const hash = await compress(JSON.stringify(data))
        history.replaceState({}, '', '#' + hash)
        showEvent(data)
    }

    async function loadEvent() {
        try {
            const data = JSON.parse(await decompress(location.hash.slice(1)))
            showEvent(data)
        } catch { }
    }

    function showEvent(data) {
        document.getElementById('editor-view').style.display = 'none'
        document.getElementById('preview-view').style.display = 'block'

        document.getElementById('p-title').textContent = data.title
        const d = new Date(data.date + 'T' + data.time)
        document.getElementById('p-date').textContent = d.toLocaleDateString('it-IT', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })
        document.getElementById('p-time').textContent = 'ore ' + data.time
        document.getElementById('p-desc').textContent = data.desc || ''
        document.title = data.title + ' - Event'

        updateCountdown(d)
        setInterval(() => updateCountdown(d), 1000)

        // Google Calendar link
        const start = data.date.replace(/-/g, '') + ('T' + data.time.replace(':', '')).replace('T', 'T') + '00'
        const end = new Date(d.getTime() + 3600000)
        const endStr = end.toISOString().replace(/[-:]/g, '').split('.')[0]
        document.getElementById('gcal').href = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(data.title)}&dates=${start}/${endStr}&details=${encodeURIComponent(data.desc || '')}`

        // iCal file
        const ical = `BEGIN:VCALENDAR\nVERSION:2.0\nBEGIN:VEVENT\nDTSTART:${start}\nDTEND:${endStr}\nSUMMARY:${data.title}\nDESCRIPTION:${data.desc || ''}\nEND:VEVENT\nEND:VCALENDAR`
        document.getElementById('ical').href = 'data:text/calendar;charset=utf-8,' + encodeURIComponent(ical)
    }

    function updateCountdown(target) {
        const now = new Date(), diff = target - now
        const el = document.getElementById('countdown'), label = document.getElementById('countdown-label')
        if (diff < 0) { el.textContent = 'üéâ Event started!'; label.textContent = ''; return }
        const days = Math.floor(diff / 86400000), hours = Math.floor((diff % 86400000) / 3600000), mins = Math.floor((diff % 3600000) / 60000), secs = Math.floor((diff % 60000) / 1000)
        if (days > 0) { el.textContent = `${days}g ${hours}h ${mins}m`; label.textContent = 'remaining' }
        else { el.textContent = `${hours}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`; label.textContent = 'remaining' }
    }

    async function compress(s) { const b = new TextEncoder().encode(s), st = new CompressionStream('deflate-raw'), w = st.writable.getWriter(); w.write(b); w.close(); return btoa(String.fromCharCode(...new Uint8Array(await new Response(st.readable).arrayBuffer()))).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '') }
    async function decompress(b) { const bin = atob(b.replace(/-/g, '+').replace(/_/g, '/')), arr = Uint8Array.from(bin, c => c.charCodeAt(0)), st = new DecompressionStream('deflate-raw'), w = st.writable.getWriter(); w.write(arr); w.close(); return new TextDecoder().decode(await new Response(st.readable).arrayBuffer()) }
    function showToast(m) { toast.textContent = m; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 2000) }
</script>