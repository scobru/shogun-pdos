<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Alarm</title>
<style>
    :root {
        --bg-gradient: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
        --text-color: #e0e0e0;
        --toolbar-bg: rgba(255, 255, 255, 0.1);
        --toolbar-border: rgba(255, 255, 255, 0.1);
        --btn-hover-bg: rgba(255, 255, 255, 0.1);
        --btn-hover-color: #fff;
        --card-bg: rgba(255, 255, 255, 0.05);
        --card-border: rgba(255, 255, 255, 0.08);
    }

    [data-theme="light"] {
        --bg-gradient: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
        --text-color: #102a43;
        --toolbar-bg: rgba(255, 255, 255, 0.9);
        --toolbar-border: rgba(0, 0, 0, 0.1);
        --btn-hover-bg: rgba(0, 0, 0, 0.05);
        --btn-hover-color: #102a43;
        --card-bg: rgba(255, 255, 255, 0.6);
        --card-border: rgba(0, 0, 0, 0.05);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html {
        background: var(--bg-gradient);
        color: var(--text-color);
        min-height: 100vh;
        transition: background 0.3s, color 0.3s;
    }

    body {
        font: 16px / 1.5 system-ui;
        padding: 20px;
        padding-bottom: 100px;
    }

    .container {
        max-width: 400px;
        margin: 0 auto;
    }

    .header-bar {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-bottom: 24px;
    }

    .header-bar h1 {
        font-size: 24px;
        background: linear-gradient(135deg, #8b5cf6, #22c55e);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .clock-display {
        text-align: center;
        margin-bottom: 32px;
    }

    .current-time {
        font-size: 64px;
        font-weight: 300;
        letter-spacing: -2px;
    }

    .current-date {
        font-size: 16px;
        opacity: 0.6;
    }

    .section-title {
        font-size: 14px;
        opacity: 0.6;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .add-btn {
        background: linear-gradient(135deg, #8b5cf6, #22c55e);
        border: none;
        color: white;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .alarms-list {
        list-style: none;
        margin-bottom: 24px;
    }

    .alarm-card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 16px;
        padding: 16px 20px;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: all 0.2s;
    }

    .alarm-card.ringing {
        animation: pulse 0.5s ease-in-out infinite alternate;
        border-color: #22c55e;
    }

    @keyframes pulse {
        from {
            transform: scale(1);
        }

        to {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
        }
    }

    .alarm-info {
        flex: 1;
    }

    .alarm-time {
        font-size: 32px;
        font-weight: 500;
    }

    .alarm-label {
        font-size: 14px;
        opacity: 0.6;
    }

    .alarm-days {
        font-size: 11px;
        opacity: 0.5;
        margin-top: 4px;
    }

    .alarm-controls {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .toggle {
        width: 50px;
        height: 28px;
        background: var(--card-border);
        border-radius: 14px;
        cursor: pointer;
        position: relative;
        transition: background 0.2s;
    }

    .toggle.active {
        background: linear-gradient(135deg, #8b5cf6, #22c55e);
    }

    .toggle::after {
        content: '';
        position: absolute;
        width: 22px;
        height: 22px;
        background: white;
        border-radius: 50%;
        top: 3px;
        left: 3px;
        transition: transform 0.2s;
    }

    .toggle.active::after {
        transform: translateX(22px);
    }

    .delete-btn {
        background: transparent;
        border: none;
        color: var(--text-color);
        cursor: pointer;
        font-size: 18px;
        opacity: 0.4;
        transition: opacity 0.2s;
    }

    .delete-btn:hover {
        opacity: 1;
        color: #ef4444;
    }

    .no-alarms {
        text-align: center;
        padding: 40px;
        opacity: 0.5;
    }

    .no-alarms .icon {
        font-size: 48px;
        margin-bottom: 12px;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        align-items: center;
        justify-content: center;
        z-index: 200;
    }

    .modal.show {
        display: flex;
    }

    .modal-content {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--card-border);
        border-radius: 20px;
        padding: 24px;
        width: 90%;
        max-width: 320px;
    }

    .modal-content h3 {
        margin-bottom: 20px;
        font-size: 18px;
        text-align: center;
    }

    .time-picker {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-bottom: 20px;
    }

    .time-picker input {
        width: 80px;
        padding: 16px;
        font-size: 32px;
        text-align: center;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        color: var(--text-color);
    }

    .time-picker span {
        font-size: 32px;
        font-weight: bold;
    }

    .form-group {
        margin-bottom: 16px;
    }

    .form-group label {
        display: block;
        font-size: 12px;
        opacity: 0.6;
        margin-bottom: 6px;
    }

    .form-group input {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--card-border);
        border-radius: 8px;
        background: var(--card-bg);
        color: var(--text-color);
        font-size: 16px;
    }

    .days-selector {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
    }

    .day-btn {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border: 1px solid var(--card-border);
        background: var(--card-bg);
        color: var(--text-color);
        cursor: pointer;
        font-size: 12px;
        transition: all 0.2s;
    }

    .day-btn.selected {
        background: linear-gradient(135deg, #8b5cf6, #22c55e);
        color: white;
        border-color: transparent;
    }

    .modal-buttons {
        display: flex;
        gap: 12px;
        margin-top: 24px;
    }

    .modal-buttons button {
        flex: 1;
        padding: 14px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-size: 16px;
    }

    .modal-buttons .cancel-btn {
        background: var(--card-bg);
        color: var(--text-color);
        border: 1px solid var(--card-border);
    }

    .modal-buttons .save-btn {
        background: linear-gradient(135deg, #8b5cf6, #22c55e);
        color: white;
    }

    /* Ringing modal */
    .ringing-modal {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .ringing-modal .alarm-icon {
        font-size: 80px;
        animation: shake 0.3s ease-in-out infinite alternate;
        margin-bottom: 20px;
    }

    @keyframes shake {
        from {
            transform: rotate(-10deg);
        }

        to {
            transform: rotate(10deg);
        }
    }

    .ringing-modal .alarm-time-display {
        font-size: 48px;
        font-weight: 300;
        margin-bottom: 8px;
    }

    .ringing-modal .alarm-label-display {
        font-size: 18px;
        opacity: 0.7;
        margin-bottom: 24px;
    }

    .dismiss-btn {
        background: linear-gradient(135deg, #8b5cf6, #22c55e);
        border: none;
        color: white;
        padding: 16px 48px;
        border-radius: 30px;
        font-size: 18px;
        cursor: pointer;
    }

    .toolbar {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--toolbar-bg);
        backdrop-filter: blur(10px);
        padding: 8px 16px;
        border-radius: 50px;
        display: flex;
        gap: 12px;
        align-items: center;
        border: 1px solid var(--toolbar-border);
        z-index: 100;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .btn {
        background: transparent;
        border: none;
        color: var(--text-color);
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s, color 0.2s;
        text-decoration: none;
        font-size: 20px;
        width: 40px;
        height: 40px;
    }

    .btn:hover {
        background: var(--btn-hover-bg);
        color: var(--btn-hover-color);
    }
</style>

<div class="container">
    <div class="header-bar">
        <span>‚è∞</span>
        <h1>Alarm</h1>
    </div>

    <div class="clock-display">
        <div class="current-time" id="current-time">00:00</div>
        <div class="current-date" id="current-date"></div>
    </div>

    <div class="section-title">
        <span>Alarms</span>
        <button class="add-btn" id="add-alarm">‚ûï Add</button>
    </div>

    <ul class="alarms-list" id="alarms-list"></ul>
</div>

<div class="modal" id="modal">
    <div class="modal-content">
        <h3 id="modal-title">New Alarm</h3>
        <div class="time-picker">
            <input type="number" id="input-hours" min="0" max="23" value="08" placeholder="08">
            <span>:</span>
            <input type="number" id="input-minutes" min="0" max="59" value="00" placeholder="00">
        </div>
        <div class="form-group">
            <label>Label</label>
            <input type="text" id="input-label" placeholder="Wake up, Meeting, etc.">
        </div>
        <div class="form-group">
            <label>Repeat</label>
            <div class="days-selector" id="days-selector">
                <button class="day-btn" data-day="0">S</button>
                <button class="day-btn" data-day="1">M</button>
                <button class="day-btn" data-day="2">T</button>
                <button class="day-btn" data-day="3">W</button>
                <button class="day-btn" data-day="4">T</button>
                <button class="day-btn" data-day="5">F</button>
                <button class="day-btn" data-day="6">S</button>
            </div>
        </div>
        <div class="modal-buttons">
            <button class="cancel-btn" id="cancel-btn">Cancel</button>
            <button class="save-btn" id="save-btn">Save</button>
        </div>
    </div>
</div>

<div class="modal" id="ringing-modal">
    <div class="modal-content ringing-modal">
        <div class="alarm-icon">‚è∞</div>
        <div class="alarm-time-display" id="ringing-time">08:00</div>
        <div class="alarm-label-display" id="ringing-label">Wake up</div>
        <button class="dismiss-btn" id="dismiss-btn">Dismiss</button>
    </div>
</div>

<div class="toolbar">
    <a href="index.html" class="btn" title="Home">üè†</a>
    <button class="btn" id="theme-toggle" title="Toggle Theme">üåì</button>
</div>

<footer style="text-align:center; padding:20px; opacity:0.5; font-size:12px; transition: opacity 0.3s;">
    <a href="https://shogun-eco.xyz" target="_blank" style="color:inherit;text-decoration:none;">shogun-eco.xyz</a>
</footer>

<script>
    const DAYS = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    const MONTHS = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

    let alarms = [];
    let editIndex = -1;
    let selectedDays = [];
    let ringingAlarm = null;
    let audioContext = null;

    const currentTimeEl = document.getElementById('current-time');
    const currentDateEl = document.getElementById('current-date');
    const alarmsList = document.getElementById('alarms-list');
    const modal = document.getElementById('modal');
    const ringingModal = document.getElementById('ringing-modal');
    const inputHours = document.getElementById('input-hours');
    const inputMinutes = document.getElementById('input-minutes');
    const inputLabel = document.getElementById('input-label');

    // Theme logic
    const themeToggle = document.getElementById('theme-toggle');
    const storedTheme = localStorage.getItem('theme');
    if (storedTheme) {
        document.documentElement.setAttribute('data-theme', storedTheme);
    } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
        document.documentElement.setAttribute('data-theme', 'light');
    }
    themeToggle.addEventListener('click', () => {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
    });

    // Clock
    function updateClock() {
        const now = new Date();
        currentTimeEl.textContent = formatTime(now.getHours(), now.getMinutes());
        currentDateEl.textContent = `${DAYS[now.getDay()]}, ${MONTHS[now.getMonth()]} ${now.getDate()}`;
        checkAlarms(now);
    }

    function formatTime(h, m) {
        return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
    }

    setInterval(updateClock, 1000);
    updateClock();

    // Day selector
    document.querySelectorAll('.day-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const day = parseInt(btn.dataset.day);
            btn.classList.toggle('selected');
            if (selectedDays.includes(day)) {
                selectedDays = selectedDays.filter(d => d !== day);
            } else {
                selectedDays.push(day);
            }
        });
    });

    document.getElementById('add-alarm').addEventListener('click', () => {
        editIndex = -1;
        document.getElementById('modal-title').textContent = 'New Alarm';
        const now = new Date();
        inputHours.value = String(now.getHours()).padStart(2, '0');
        inputMinutes.value = '00';
        inputLabel.value = '';
        selectedDays = [];
        document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('selected'));
        modal.classList.add('show');
        inputHours.focus();
    });

    document.getElementById('cancel-btn').addEventListener('click', () => {
        modal.classList.remove('show');
    });

    document.getElementById('save-btn').addEventListener('click', saveAlarm);

    document.getElementById('dismiss-btn').addEventListener('click', dismissAlarm);

    function saveAlarm() {
        const hours = parseInt(inputHours.value) || 0;
        const minutes = parseInt(inputMinutes.value) || 0;
        const label = inputLabel.value.trim() || 'Alarm';

        const alarm = {
            id: editIndex >= 0 ? alarms[editIndex].id : Date.now(),
            hours: Math.min(23, Math.max(0, hours)),
            minutes: Math.min(59, Math.max(0, minutes)),
            label,
            days: [...selectedDays].sort(),
            enabled: true
        };

        if (editIndex >= 0) {
            alarms[editIndex] = alarm;
        } else {
            alarms.push(alarm);
        }

        alarms.sort((a, b) => (a.hours * 60 + a.minutes) - (b.hours * 60 + b.minutes));
        modal.classList.remove('show');
        render();
        saveData();
    }

    function toggleAlarm(index) {
        alarms[index].enabled = !alarms[index].enabled;
        render();
        saveData();
    }

    function deleteAlarm(index) {
        alarms.splice(index, 1);
        render();
        saveData();
    }

    function editAlarm(index) {
        editIndex = index;
        const alarm = alarms[index];
        document.getElementById('modal-title').textContent = 'Edit Alarm';
        inputHours.value = String(alarm.hours).padStart(2, '0');
        inputMinutes.value = String(alarm.minutes).padStart(2, '0');
        inputLabel.value = alarm.label;
        selectedDays = [...alarm.days];
        document.querySelectorAll('.day-btn').forEach(btn => {
            const day = parseInt(btn.dataset.day);
            btn.classList.toggle('selected', selectedDays.includes(day));
        });
        modal.classList.add('show');
    }

    function checkAlarms(now) {
        if (ringingAlarm) return;

        const currentHours = now.getHours();
        const currentMinutes = now.getMinutes();
        const currentDay = now.getDay();
        const currentSeconds = now.getSeconds();

        if (currentSeconds !== 0) return;

        alarms.forEach(alarm => {
            if (!alarm.enabled) return;
            if (alarm.hours !== currentHours || alarm.minutes !== currentMinutes) return;
            if (alarm.days.length > 0 && !alarm.days.includes(currentDay)) return;

            triggerAlarm(alarm);
        });
    }

    function triggerAlarm(alarm) {
        ringingAlarm = alarm;
        document.getElementById('ringing-time').textContent = formatTime(alarm.hours, alarm.minutes);
        document.getElementById('ringing-label').textContent = alarm.label;
        ringingModal.classList.add('show');
        playAlarmSound();

        // Mark card as ringing
        render();
    }

    function dismissAlarm() {
        ringingModal.classList.remove('show');
        stopAlarmSound();

        if (ringingAlarm && ringingAlarm.days.length === 0) {
            // One-time alarm, disable it
            const index = alarms.findIndex(a => a.id === ringingAlarm.id);
            if (index >= 0) {
                alarms[index].enabled = false;
                saveData();
            }
        }

        ringingAlarm = null;
        render();
    }

    function playAlarmSound() {
        try {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.frequency.value = 800;
            gain.gain.value = 0.3;
            osc.start();

            // Beep pattern
            let beeping = true;
            const interval = setInterval(() => {
                if (!ringingAlarm) {
                    clearInterval(interval);
                    return;
                }
                beeping = !beeping;
                gain.gain.value = beeping ? 0.3 : 0;
            }, 500);
        } catch (e) {
            console.log('Audio not available');
        }
    }

    function stopAlarmSound() {
        if (audioContext) {
            audioContext.close();
            audioContext = null;
        }
    }

    function render() {
        if (alarms.length === 0) {
            alarmsList.innerHTML = `
        <li class="no-alarms">
          <div class="icon">‚è∞</div>
          No alarms set.<br>Tap + to add one!
        </li>
      `;
            return;
        }

        alarmsList.innerHTML = alarms.map((alarm, i) => {
            const isRinging = ringingAlarm && ringingAlarm.id === alarm.id;
            const daysText = alarm.days.length === 7 ? 'Every day' :
                alarm.days.length === 0 ? 'Once' :
                    alarm.days.map(d => DAYS[d].slice(0, 2)).join(', ');
            return `
        <li class="alarm-card ${isRinging ? 'ringing' : ''}" onclick="editAlarm(${i})">
          <div class="alarm-info">
            <div class="alarm-time">${formatTime(alarm.hours, alarm.minutes)}</div>
            <div class="alarm-label">${alarm.label}</div>
            <div class="alarm-days">${daysText}</div>
          </div>
          <div class="alarm-controls">
            <div class="toggle ${alarm.enabled ? 'active' : ''}" onclick="event.stopPropagation(); toggleAlarm(${i})"></div>
            <button class="delete-btn" onclick="event.stopPropagation(); deleteAlarm(${i})">‚úï</button>
          </div>
        </li>
      `;
        }).join('');
    }

    function saveData() {
        try { localStorage.setItem('alarms-data', JSON.stringify(alarms)); } catch (e) { }
    }

    function loadData() {
        try {
            const stored = localStorage.getItem('alarms-data');
            if (stored) alarms = JSON.parse(stored);
        } catch (e) { }
        render();
    }

    loadData();
</script>