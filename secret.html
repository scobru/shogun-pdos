<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SECRET</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
<style>
    body {
        padding: 20px;
        padding-bottom: 100px;
        
        align-items: center;
    }

    .container {
        width: 100%;
        max-width: 500px;
    }

    header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 20px;
    }.subtitle {
        text-align: center;
        font-size: 10px;
        opacity: 0.7;
        margin-bottom: 24px;
        text-transform: uppercase;
    }

    textarea {
        width: 100%;
        height: 150px;
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-color);
        font-family: var(--font-stack);
        padding: 12px;
        margin-bottom: 12px;
        resize: none;
        outline: none;
    }

    textarea:focus {
        border-color: var(--accent-color);
    }

    input {
        width: 100%;
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-color);
        font-family: var(--font-stack);
        padding: 12px;
        margin-bottom: 16px;
        outline: none;
    }

    input:focus {
        border-color: var(--accent-color);
    }

    button {
        width: 100%;
        padding: 16px;
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-color);
        font-family: var(--font-stack);
        text-transform: uppercase;
        cursor: pointer;
        font-weight: bold;
        margin-bottom: 12px;
    }

    button:hover {
        background: var(--text-color);
        color: var(--bg-color);
    }

    /* Toolbar */
    .toolbar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: var(--bg-color);
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: space-around;
        padding: 16px;
    }

    .toolbar a {
        color: var(--text-color);
        text-decoration: none;
        font-family: var(--font-stack);
        font-size: 14px;
        text-transform: uppercase;
    }

    

    .locked-view {
        text-align: center;
        border: 1px solid var(--border-color);
        padding: 30px;
        margin-bottom: 20px;
    }

    .lock-icon {
        font-size: 40px;
        color: var(--accent-color);
        margin-bottom: 16px;
    }
</style>

<div class="container">
    <header>
        <h1>SECRET</h1>
    </header>
    <div class="subtitle">Client-side Encryption. Zero Knowledge.</div>

    <div id="encrypt-view">
        <textarea id="msg-input" placeholder="ENTER SECRET MESSAGE..."></textarea>
        <input type="password" id="pass-input" placeholder="PASSWORD">
        <button id="encrypt">ENCRYPT & SHARE</button>
    </div>

    <div id="decrypt-view" style="display:none">
        <div class="locked-view">
            <div class="lock-icon">[LOCKED]</div>
            <input type="password" id="decrypt-pass" placeholder="PASSWORD">
            <button id="decrypt">DECRYPT</button>
        </div>
        <div id="result" style="display:none">
            <textarea id="decrypted-msg" readonly></textarea>
            <button id="new">NEW SECRET</button>
        </div>
    </div>
</div>

<div class="toolbar">
    <a href="index.html">[HOME]</a>
</div>

<div class="toast" id="toast">LINK COPIED</div>

<script>
    const toast = document.getElementById('toast');

    if (location.hash.length > 5) {
        document.getElementById('encrypt-view').style.display = 'none';
        document.getElementById('decrypt-view').style.display = 'block';
    }

    document.getElementById('encrypt').addEventListener('click', async () => {
        const msg = document.getElementById('msg-input').value;
        const pass = document.getElementById('pass-input').value;
        if (!msg || !pass) { showToast('MISSING INFO'); return; }

        try {
            const enc = await encrypt(msg, pass);
            history.replaceState({}, '', '#' + enc);
            await navigator.clipboard.writeText(location.href);
            showToast('LINK COPIED');
        } catch { showToast('ERROR'); }
    });

    document.getElementById('decrypt').addEventListener('click', async () => {
        const pass = document.getElementById('decrypt-pass').value;
        if (!pass) return;

        try {
            const msg = await decrypt(location.hash.slice(1), pass);
            document.querySelector('.locked-view').style.display = 'none';
            document.getElementById('result').style.display = 'block';
            document.getElementById('decrypted-msg').value = msg;
        } catch { showToast('WRONG PASSWORD'); }
    });

    document.getElementById('new').addEventListener('click', () => { location.hash = ''; location.reload(); });

    async function encrypt(text, password) {
        const enc = new TextEncoder();
        const keyMat = await crypto.subtle.importKey('raw', enc.encode(password), 'PBKDF2', false, ['deriveKey']);
        const salt = crypto.getRandomValues(new Uint8Array(16));
        const key = await crypto.subtle.deriveKey({ name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' }, keyMat, { name: 'AES-GCM', length: 256 }, false, ['encrypt']);
        const iv = crypto.getRandomValues(new Uint8Array(12));
        const encrypted = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, enc.encode(text));

        const combined = new Uint8Array(salt.length + iv.length + encrypted.byteLength);
        combined.set(salt, 0); combined.set(iv, salt.length); combined.set(new Uint8Array(encrypted), salt.length + iv.length);

        return btoa(String.fromCharCode(...combined)).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
    }

    async function decrypt(data, password) {
        const bin = atob(data.replace(/-/g, '+').replace(/_/g, '/'));
        const combined = Uint8Array.from(bin, c => c.charCodeAt(0));
        const salt = combined.slice(0, 16);
        const iv = combined.slice(16, 28);
        const encrypted = combined.slice(28);

        const enc = new TextEncoder();
        const keyMat = await crypto.subtle.importKey('raw', enc.encode(password), 'PBKDF2', false, ['deriveKey']);
        const key = await crypto.subtle.deriveKey({ name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' }, keyMat, { name: 'AES-GCM', length: 256 }, false, ['decrypt']);

        const dec = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, encrypted);
        return new TextDecoder().decode(dec);
    }

    function showToast(m) { toast.textContent = m; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 2000); }
</script>