<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Secret</title>
<style>
    :root {
        --bg-gradient: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
        --text-color: #e0e0e0;
        --input-bg: rgba(255, 255, 255, 0.1);
        --input-focus-bg: rgba(255, 255, 255, 0.15);
        --btn-secondary-bg: rgba(255, 255, 255, 0.1);
        --btn-secondary-hover: rgba(255, 255, 255, 0.2);
        --info-bg: rgba(255, 255, 255, 0.05);
        --info-code-bg: rgba(255, 255, 255, 0.1);
    }

    [data-theme="light"] {
        --bg-gradient: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
        --text-color: #102a43;
        --input-bg: rgba(0, 0, 0, 0.05);
        --input-focus-bg: rgba(0, 0, 0, 0.08);
        --btn-secondary-bg: rgba(0, 0, 0, 0.05);
        --btn-secondary-hover: rgba(0, 0, 0, 0.1);
        --info-bg: rgba(255, 255, 255, 0.6);
        --info-code-bg: rgba(0, 0, 0, 0.05);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html {
        background: var(--bg-gradient);
        color: var(--text-color);
        min-height: 100vh;
        transition: background 0.3s, color 0.3s;
    }

    body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        font: 16px/1.5 system-ui;
    }

    .header-bar {
        display: flex;
        align-items: center;
        width: 100%;
        max-width: 600px;
        margin-bottom: 24px;
    }

    .home-link {
        text-decoration: none;
        font-size: 20px;
        margin-right: 16px;
        opacity: 0.7;
        transition: opacity 0.2s;
    }

    .home-link:hover {
        opacity: 1;
    }

    h1 {
        flex: 1;
        text-align: center;
        margin: 0;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        line-height: 1;
    }

    h1 span {
        display: flex;
        align-items: center;
    }

    .theme-toggle {
        background: transparent;
        border: none;
        cursor: pointer;
        font-size: 20px;
        padding: 0 0 0 16px;
        opacity: 0.7;
        transition: opacity 0.2s;
    }

    .theme-toggle:hover {
        opacity: 1;
        transform: scale(1.1);
    }

    .container {
        width: 100%;
        max-width: 600px;
    }

    .subtitle {
        text-align: center;
        opacity: 0.6;
        margin-bottom: 24px;
        font-size: 14px;
    }

    textarea {
        width: 100%;
        height: 200px;
        padding: 16px;
        border: none;
        border-radius: 12px;
        font: inherit;
        resize: vertical;
        background: var(--input-bg);
        color: inherit;
        margin-bottom: 16px;
    }

    textarea:focus {
        outline: none;
        background: var(--input-focus-bg);
    }

    .row {
        display: flex;
        gap: 12px;
        margin-bottom: 16px;
    }

    input {
        flex: 1;
        padding: 12px 16px;
        border: none;
        border-radius: 8px;
        font: inherit;
        background: var(--input-bg);
        color: inherit;
    }

    input:focus {
        outline: none;
        background: var(--input-focus-bg);
    }

    button {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font: inherit;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.15s;
    }

    .primary {
        background: linear-gradient(135deg, #8b5cf6, #6d28d9);
        color: white;
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        width: 100%;
    }

    .primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
    }

    .secondary {
        background: var(--btn-secondary-bg);
        color: inherit;
        width: 100%;
    }

    .secondary:hover {
        background: var(--btn-secondary-hover);
    }

    .actions {
        display: flex;
        gap: 12px;
        justify-content: center;
    }

    .status {
        text-align: center;
        margin-top: 16px;
        padding: 12px;
        border-radius: 8px;
        font-size: 14px;
        display: none;
    }

    .status.success {
        display: block;
        background: rgba(34, 197, 94, 0.2);
        color: #22c55e;
    }

    .status.error {
        display: block;
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
    }

    .locked {
        text-align: center;
        padding: 40px;
    }

    .lock-icon {
        font-size: 64px;
        margin-bottom: 16px;
    }

    .info {
        margin-top: 24px;
        padding: 16px;
        background: var(--info-bg);
        border-radius: 8px;
        font-size: 13px;
        opacity: 0.7;
    }

    .info code {
        background: var(--info-code-bg);
        padding: 2px 6px;
        border-radius: 4px;
    }
</style>

<div class="header-bar">
    <a href="index.html" class="home-link" title="Home">üè†</a>
    <h1><span>üîê</span><span>Secret</span></h1>
    <button class="theme-toggle" id="theme-toggle" title="Toggle theme">üåì</button>
</div>
<p class="subtitle">Encrypted notes in your URL. Zero servers.</p>

<div id="editor-view">
    <textarea id="message" placeholder="Write your secret message..."></textarea>
    <div class="row">
        <input type="password" id="password" placeholder="Password (remember it!)">
    </div>
    <div class="actions">
        <button id="encrypt">üîê Encrypt & Copy Link</button>
    </div>
    <div class="info">
        <strong>How it works:</strong><br>
        Your message is encrypted with <code>AES-GCM</code> in your browser.<br>
        The encrypted data goes in the URL. Share the link + password separately.
    </div>
</div>

<div id="decrypt-view" style="display:none">
    <div class="locked">
        <div class="lock-icon">üîí</div>
        <p>This message is encrypted</p>
    </div>
    <div class="row">
        <input type="password" id="decrypt-password" placeholder="Enter password to decrypt">
        <button class="primary" id="decrypt">üîì Decrypt</button>
    </div>
    <textarea id="decrypted" readonly style="display:none"></textarea>
    <div class="actions" style="margin-top:16px">
        <button class="secondary" id="new-secret">‚ú® Create New Secret</button>
    </div>
</div>

<div id="status" class="status"></div>

<script>
    const editorView = document.getElementById('editor-view')
    const decryptView = document.getElementById('decrypt-view')
    const message = document.getElementById('message')
    const password = document.getElementById('password')
    const decryptPassword = document.getElementById('decrypt-password')
    const decrypted = document.getElementById('decrypted')
    const status = document.getElementById('status')

    // Theme logic
    const themeToggle = document.getElementById('theme-toggle');
    const storedTheme = localStorage.getItem('theme');
    if (storedTheme) {
        document.documentElement.setAttribute('data-theme', storedTheme);
    } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
        document.documentElement.setAttribute('data-theme', 'light');
    }
    themeToggle.addEventListener('click', () => {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
    });
    // Check if we have encrypted data in URL
    if (location.hash.length > 1) {
        editorView.style.display = 'none'
        decryptView.style.display = 'block'
    }

    document.getElementById('encrypt').addEventListener('click', async () => {
        const msg = message.value
        const pwd = password.value

        if (!msg || !pwd) {
            showStatus('Please enter a message and password', 'error')
            return
        }

        try {
            const encrypted = await encrypt(msg, pwd)
            location.hash = encrypted
            await navigator.clipboard.writeText(location.href)
            showStatus('‚úì Encrypted! Link copied to clipboard. Share it securely!', 'success')
        } catch (e) {
            showStatus('Encryption failed: ' + e.message, 'error')
        }
    })

    document.getElementById('decrypt').addEventListener('click', async () => {
        const pwd = decryptPassword.value
        const data = location.hash.slice(1)

        if (!pwd) {
            showStatus('Please enter the password', 'error')
            return
        }

        try {
            const msg = await decrypt(data, pwd)
            decrypted.value = msg
            decrypted.style.display = 'block'
            document.querySelector('.locked').style.display = 'none'
            showStatus('‚úì Decrypted successfully!', 'success')
        } catch (e) {
            showStatus('Wrong password or corrupted data', 'error')
        }
    })

    document.getElementById('new-secret').addEventListener('click', () => {
        location.hash = ''
        location.reload()
    })

    async function encrypt(text, password) {
        const enc = new TextEncoder()
        const keyMaterial = await crypto.subtle.importKey(
            'raw', enc.encode(password), 'PBKDF2', false, ['deriveBits', 'deriveKey']
        )
        const salt = crypto.getRandomValues(new Uint8Array(16))
        const key = await crypto.subtle.deriveKey(
            { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
            keyMaterial, { name: 'AES-GCM', length: 256 }, false, ['encrypt']
        )
        const iv = crypto.getRandomValues(new Uint8Array(12))
        const encrypted = await crypto.subtle.encrypt(
            { name: 'AES-GCM', iv }, key, enc.encode(text)
        )
        const combined = new Uint8Array(salt.length + iv.length + encrypted.byteLength)
        combined.set(salt, 0)
        combined.set(iv, salt.length)
        combined.set(new Uint8Array(encrypted), salt.length + iv.length)
        return btoa(String.fromCharCode(...combined))
            .replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '')
    }

    async function decrypt(data, password) {
        const binary = atob(data.replace(/-/g, '+').replace(/_/g, '/'))
        const combined = Uint8Array.from(binary, c => c.charCodeAt(0))
        const salt = combined.slice(0, 16)
        const iv = combined.slice(16, 28)
        const encrypted = combined.slice(28)

        const enc = new TextEncoder()
        const keyMaterial = await crypto.subtle.importKey(
            'raw', enc.encode(password), 'PBKDF2', false, ['deriveBits', 'deriveKey']
        )
        const key = await crypto.subtle.deriveKey(
            { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
            keyMaterial, { name: 'AES-GCM', length: 256 }, false, ['decrypt']
        )
        const decrypted = await crypto.subtle.decrypt(
            { name: 'AES-GCM', iv }, key, encrypted
        )
        return new TextDecoder().decode(decrypted)
    }

    function showStatus(msg, type) {
        status.textContent = msg
        status.className = 'status ' + type
        setTimeout(() => status.className = 'status', 4000)
    }
</script>