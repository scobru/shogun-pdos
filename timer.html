<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Timer</title>
<style>
    :root {
        --bg-gradient: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
        --text-color: #e0e0e0;
        --tabs-bg: rgba(255, 255, 255, 0.05);
        --tab-active-bg: rgba(255, 255, 255, 0.15);
        --preset-bg: rgba(255, 255, 255, 0.05);
        --preset-border: rgba(255, 255, 255, 0.1);
        --preset-hover-bg: rgba(139, 92, 246, 0.1);
        --input-bg: rgba(255, 255, 255, 0.1);
        --input-focus-bg: rgba(255, 255, 255, 0.2);
        --lap-list-bg: rgba(255, 255, 255, 0.05);
        --lap-border: rgba(255, 255, 255, 0.05);
        --btn-reset-bg: rgba(255, 255, 255, 0.1);
        --btn-reset-hover: rgba(255, 255, 255, 0.2);
    }

    [data-theme="light"] {
        --bg-gradient: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
        --text-color: #102a43;
        --tabs-bg: rgba(255, 255, 255, 0.4);
        --tab-active-bg: rgba(255, 255, 255, 0.8);
        --preset-bg: rgba(255, 255, 255, 0.5);
        --preset-border: rgba(0, 0, 0, 0.1);
        --preset-hover-bg: rgba(139, 92, 246, 0.1);
        --input-bg: rgba(0, 0, 0, 0.05);
        --input-focus-bg: rgba(0, 0, 0, 0.08);
        --lap-list-bg: rgba(255, 255, 255, 0.5);
        --lap-border: rgba(0, 0, 0, 0.05);
        --btn-reset-bg: rgba(0, 0, 0, 0.05);
        --btn-reset-hover: rgba(0, 0, 0, 0.1);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html {
        background: var(--bg-gradient);
        color: var(--text-color);
        min-height: 100vh;
        transition: background 0.3s, color 0.3s;
    }

    body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        font: 16px/1.5 system-ui;
        max-width: 500px;
        margin: 0 auto;
    }

    .header-bar {
        display: flex;
        align-items: center;
        width: 100%;
        margin-bottom: 24px;
    }

    .home-link {
        text-decoration: none;
        font-size: 20px;
        margin-right: 16px;
        opacity: 0.7;
        transition: opacity 0.2s;
    }

    .home-link:hover {
        opacity: 1;
    }

    h1 {
        flex: 1;
        text-align: center;
        margin: 0;
        font-size: 24px;
    }

    .theme-toggle {
        background: transparent;
        border: none;
        cursor: pointer;
        font-size: 20px;
        padding: 0 0 0 16px;
        opacity: 0.7;
        transition: opacity 0.2s;
    }

    .theme-toggle:hover {
        opacity: 1;
        transform: scale(1.1);
    }

    .tabs {
        display: flex;
        gap: 4px;
        margin-bottom: 32px;
        background: var(--tabs-bg);
        padding: 4px;
        border-radius: 12px;
    }

    .tab {
        padding: 10px 24px;
        border: none;
        border-radius: 10px;
        font: inherit;
        cursor: pointer;
        background: transparent;
        color: inherit;
        opacity: 0.6;
        transition: all 0.2s;
    }

    .tab.active {
        background: var(--tab-active-bg);
        opacity: 1;
        font-weight: 600;
    }

    .timer-display {
        font-size: 96px;
        font-weight: 200;
        font-variant-numeric: tabular-nums;
        letter-spacing: -4px;
        margin-bottom: 32px;
        transition: color 0.3s;
    }

    .timer-display.warning {
        color: #f59e0b;
    }

    .timer-display.danger {
        color: #ef4444;
        animation: pulse 1s infinite;
    }

    @keyframes pulse {

        0%,
        100% {
            opacity: 1;
        }

        50% {
            opacity: 0.5;
        }
    }

    .presets {
        display: flex;
        gap: 8px;
        margin-bottom: 24px;
        flex-wrap: wrap;
        justify-content: center;
    }

    .preset {
        padding: 10px 20px;
        border: 1px solid var(--preset-border);
        border-radius: 10px;
        background: var(--preset-bg);
        color: inherit;
        font: inherit;
        cursor: pointer;
        transition: all 0.2s;
    }

    .preset:hover {
        border-color: #8b5cf6;
        background: var(--preset-hover-bg);
    }

    .custom-input {
        display: flex;
        gap: 8px;
        margin-bottom: 24px;
        align-items: center;
    }

    input {
        width: 70px;
        padding: 10px;
        border: none;
        border-radius: 8px;
        background: var(--input-bg);
        color: inherit;
        font: inherit;
        text-align: center;
    }

    input:focus {
        outline: none;
        background: var(--input-focus-bg);
    }

    .controls {
        display: flex;
        gap: 12px;
    }

    button {
        padding: 16px 32px;
        border: none;
        border-radius: 12px;
        font: inherit;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        color: inherit;
    }

    .start {
        background: linear-gradient(135deg, #22c55e, #16a34a);
        color: white;
        min-width: 120px;
    }

    .start:hover {
        transform: scale(1.05);
    }

    .start.running {
        background: linear-gradient(135deg, #ef4444, #dc2626);
    }

    .reset {
        background: var(--btn-reset-bg);
    }

    .reset:hover {
        background: var(--btn-reset-hover);
    }

    .pomodoro-info {
        margin-top: 32px;
        text-align: center;
        opacity: 0.6;
    }

    .pomodoro-count {
        font-size: 24px;
        margin-bottom: 8px;
    }

    .stopwatch,
    .timer-mode {
        display: none;
    }

    .stopwatch.active,
    .timer-mode.active {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .lap-list {
        margin-top: 24px;
        max-height: 200px;
        overflow-y: auto;
        width: 100%;
        max-width: 300px;
        background: var(--lap-list-bg);
        border-radius: 12px;
    }

    .lap {
        display: flex;
        justify-content: space-between;
        padding: 12px 16px;
        border-bottom: 1px solid var(--lap-border);
    }

    .toast {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        padding: 8px 16px;
        background: #22c55e;
        color: white;
        border-radius: 20px;
        font-size: 14px;
        opacity: 0;
        transition: all 0.3s;
        pointer-events: none;
    }

    .toast.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }
</style>

<div class="header-bar">
    <a href="index.html" class="home-link" title="Home">üè†</a>
    <h1>‚è±Ô∏è Timer</h1>
    <button class="theme-toggle" id="theme-toggle" title="Toggle theme">üåì</button>
</div>

<div class="tabs">
    <button class="tab active" data-mode="timer">Timer</button>
    <button class="tab" data-mode="pomodoro">Pomodoro</button>
    <button class="tab" data-mode="stopwatch">Stopwatch</button>
</div>

<div class="timer-mode active" id="timer-view">
    <div class="timer-display" id="timer-display">00:00</div>

    <div class="presets">
        <button class="preset" data-secs="60">1 min</button>
        <button class="preset" data-secs="180">3 min</button>
        <button class="preset" data-secs="300">5 min</button>
        <button class="preset" data-secs="600">10 min</button>
        <button class="preset" data-secs="900">15 min</button>
    </div>

    <div class="custom-input">
        <input type="number" id="custom-min" placeholder="min" min="0" max="99">
        <span>:</span>
        <input type="number" id="custom-sec" placeholder="sec" min="0" max="59">
        <button class="preset" id="set-custom">Set</button>
    </div>

    <div class="controls">
        <button class="start" id="timer-start">‚ñ∂ Start</button>
        <button class="reset" id="timer-reset">‚Ü∫ Reset</button>
    </div>
</div>

<div class="timer-mode" id="pomodoro-view">
    <div class="timer-display" id="pomo-display">25:00</div>

    <div class="controls">
        <button class="start" id="pomo-start">‚ñ∂ Start</button>
        <button class="reset" id="pomo-reset">‚Ü∫ Reset</button>
    </div>

    <div class="pomodoro-info">
        <div class="pomodoro-count">üçÖ <span id="pomo-count">0</span></div>
        <div>25 min work, 5 min break</div>
    </div>
</div>

<div class="timer-mode" id="stopwatch-view">
    <div class="timer-display" id="sw-display">00:00.00</div>

    <div class="controls">
        <button class="start" id="sw-start">‚ñ∂ Start</button>
        <button class="reset" id="sw-lap">‚è± Lap</button>
        <button class="reset" id="sw-reset">‚Ü∫ Reset</button>
    </div>

    <div class="lap-list" id="laps"></div>
</div>

<div class="toast" id="toast"></div>

<audio id="alarm" preload="auto">
    <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAABgA=" type="audio/wav">
</audio>

<script>
    const tabs = document.querySelectorAll('.tab')
    const views = document.querySelectorAll('.timer-mode')

    // Theme logic
    const toggle = document.getElementById('theme-toggle');
    const storedTheme = localStorage.getItem('theme');
    if (storedTheme) {
        document.documentElement.setAttribute('data-theme', storedTheme);
    } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
        document.documentElement.setAttribute('data-theme', 'light');
    }
    toggle.addEventListener('click', () => {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
    });

    // Tab switching
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('active'))
            tab.classList.add('active')
            const mode = tab.dataset.mode
            views.forEach(v => v.classList.toggle('active', v.id === `${mode}-view`))
        })
    })

    // === TIMER ===
    let timerSeconds = 0
    let timerRunning = false
    let timerInterval = null
    const timerDisplay = document.getElementById('timer-display')
    const timerStartBtn = document.getElementById('timer-start')

    document.querySelectorAll('.preset[data-secs]').forEach(btn => {
        btn.addEventListener('click', () => {
            timerSeconds = parseInt(btn.dataset.secs)
            updateTimerDisplay()
        })
    })

    document.getElementById('set-custom').addEventListener('click', () => {
        const min = parseInt(document.getElementById('custom-min').value) || 0
        const sec = parseInt(document.getElementById('custom-sec').value) || 0
        timerSeconds = min * 60 + sec
        updateTimerDisplay()
    })

    timerStartBtn.addEventListener('click', () => {
        if (timerRunning) {
            stopTimer()
        } else {
            startTimer()
        }
    })

    document.getElementById('timer-reset').addEventListener('click', () => {
        stopTimer()
        timerSeconds = 0
        updateTimerDisplay()
    })

    function startTimer() {
        if (timerSeconds <= 0) return
        timerRunning = true
        timerStartBtn.textContent = '‚è∏ Pause'
        timerStartBtn.classList.add('running')
        timerInterval = setInterval(() => {
            timerSeconds--
            updateTimerDisplay()
            if (timerSeconds <= 0) {
                stopTimer()
                playAlarm()
                showToast('‚è∞ Time is up!')
            }
        }, 1000)
    }

    function stopTimer() {
        timerRunning = false
        timerStartBtn.textContent = '‚ñ∂ Start'
        timerStartBtn.classList.remove('running')
        clearInterval(timerInterval)
    }

    function updateTimerDisplay() {
        const min = Math.floor(timerSeconds / 60)
        const sec = timerSeconds % 60
        timerDisplay.textContent = `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`
        timerDisplay.classList.toggle('warning', timerSeconds <= 60 && timerSeconds > 10)
        timerDisplay.classList.toggle('danger', timerSeconds <= 10 && timerSeconds > 0)
    }

    // === POMODORO ===
    let pomoSeconds = 25 * 60
    let pomoRunning = false
    let pomoInterval = null
    let pomoCount = 0
    let isBreak = false
    const pomoDisplay = document.getElementById('pomo-display')
    const pomoStartBtn = document.getElementById('pomo-start')
    const pomoCountEl = document.getElementById('pomo-count')

    pomoStartBtn.addEventListener('click', () => {
        if (pomoRunning) {
            stopPomo()
        } else {
            startPomo()
        }
    })

    document.getElementById('pomo-reset').addEventListener('click', () => {
        stopPomo()
        pomoSeconds = 25 * 60
        isBreak = false
        updatePomoDisplay()
    })

    function startPomo() {
        pomoRunning = true
        pomoStartBtn.textContent = '‚è∏ Pause'
        pomoStartBtn.classList.add('running')
        pomoInterval = setInterval(() => {
            pomoSeconds--
            updatePomoDisplay()
            if (pomoSeconds <= 0) {
                stopPomo()
                playAlarm()
                if (!isBreak) {
                    pomoCount++
                    pomoCountEl.textContent = pomoCount
                    isBreak = true
                    pomoSeconds = 5 * 60
                    showToast('üçÖ Pomodoro complete! 5 min break')
                } else {
                    isBreak = false
                    pomoSeconds = 25 * 60
                    showToast('‚òï Break over! Ready for another?')
                }
                updatePomoDisplay()
            }
        }, 1000)
    }

    function stopPomo() {
        pomoRunning = false
        pomoStartBtn.textContent = '‚ñ∂ Start'
        pomoStartBtn.classList.remove('running')
        clearInterval(pomoInterval)
    }

    function updatePomoDisplay() {
        const min = Math.floor(pomoSeconds / 60)
        const sec = pomoSeconds % 60
        pomoDisplay.textContent = `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`
        pomoDisplay.classList.toggle('warning', pomoSeconds <= 60 && pomoSeconds > 10)
        pomoDisplay.classList.toggle('danger', pomoSeconds <= 10 && pomoSeconds > 0)
    }

    // === STOPWATCH ===
    let swMs = 0
    let swRunning = false
    let swInterval = null
    let laps = []
    const swDisplay = document.getElementById('sw-display')
    const swStartBtn = document.getElementById('sw-start')
    const lapsEl = document.getElementById('laps')

    swStartBtn.addEventListener('click', () => {
        if (swRunning) {
            stopSW()
        } else {
            startSW()
        }
    })

    document.getElementById('sw-lap').addEventListener('click', () => {
        if (swRunning) {
            laps.push(swMs)
            updateLaps()
        }
    })

    document.getElementById('sw-reset').addEventListener('click', () => {
        stopSW()
        swMs = 0
        laps = []
        updateSWDisplay()
        lapsEl.innerHTML = ''
    })

    function startSW() {
        swRunning = true
        swStartBtn.textContent = '‚è∏ Pause'
        swStartBtn.classList.add('running')
        const startTime = Date.now() - swMs
        swInterval = setInterval(() => {
            swMs = Date.now() - startTime
            updateSWDisplay()
        }, 10)
    }

    function stopSW() {
        swRunning = false
        swStartBtn.textContent = '‚ñ∂ Start'
        swStartBtn.classList.remove('running')
        clearInterval(swInterval)
    }

    function updateSWDisplay() {
        const min = Math.floor(swMs / 60000)
        const sec = Math.floor((swMs % 60000) / 1000)
        const ms = Math.floor((swMs % 1000) / 10)
        swDisplay.textContent = `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}.${String(ms).padStart(2, '0')}`
    }

    function updateLaps() {
        lapsEl.innerHTML = laps.map((lap, i) => {
            const min = Math.floor(lap / 60000)
            const sec = Math.floor((lap % 60000) / 1000)
            const ms = Math.floor((lap % 1000) / 10)
            return `<div class="lap"><span>Lap ${i + 1}</span><span>${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}.${String(ms).padStart(2, '0')}</span></div>`
        }).reverse().join('')
    }

    // === UTILS ===
    function playAlarm() {
        // Generate beep with Web Audio API
        const ctx = new (window.AudioContext || window.webkitAudioContext)()
        for (let i = 0; i < 3; i++) {
            setTimeout(() => {
                const osc = ctx.createOscillator()
                const gain = ctx.createGain()
                osc.connect(gain)
                gain.connect(ctx.destination)
                osc.frequency.value = 800
                gain.gain.setValueAtTime(0.3, ctx.currentTime)
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3)
                osc.start()
                osc.stop(ctx.currentTime + 0.3)
            }, i * 400)
        }
    }

    function showToast(msg) {
        const toast = document.getElementById('toast')
        toast.textContent = msg
        toast.classList.add('show')
        setTimeout(() => toast.classList.remove('show'), 3000)
    }
</script>