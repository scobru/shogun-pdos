<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>QR</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
<style>
    body {
        padding: 20px;
        padding-bottom: 100px;
        
        align-items: center;
    }

    .container {
        width: 100%;
        max-width: 500px;
    }

    header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 20px;
    }.tabs {
        display: flex;
        border: 1px solid var(--border-color);
        margin-bottom: 24px;
    }

    .tab {
        flex: 1;
        padding: 12px;
        background: transparent;
        border: none;
        color: var(--text-color);
        font-family: var(--font-stack);
        text-transform: uppercase;
        cursor: pointer;
        border-right: 1px solid var(--border-color);
    }

    .tab:last-child {
        border-right: none;
    }

    .tab.active {
        background: var(--text-color);
        color: var(--bg-color);
        font-weight: bold;
    }

    textarea,
    input,
    select {
        width: 100%;
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-color);
        font-family: var(--font-stack);
        padding: 12px;
        outline: none;
        margin-bottom: 16px;
    }

    textarea:focus,
    input:focus {
        border-color: var(--accent-color);
    }

    textarea {
        height: 100px;
        resize: vertical;
    }

    .wifi-fields {
        display: none;
    }

    .wifi-fields.active {
        display: block;
    }

    #qr-container {
        background: var(--bg-color);
        border: 1px solid var(--border-color);
        padding: 20px;
        display: flex;
        justify-content: center;
        margin-bottom: 24px;
    }

    #qr {
        display: block;
        max-width: 100%;
    }

    .actions {
        display: flex;
        gap: 16px;
    }

    button {
        flex: 1;
        padding: 14px;
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-color);
        font-family: var(--font-stack);
        text-transform: uppercase;
        cursor: pointer;
        font-weight: bold;
    }

    button:hover {
        background: var(--text-color);
        color: var(--bg-color);
    }

    /* Toolbar */
    .toolbar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: var(--bg-color);
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: space-around;
        padding: 16px;
    }

    .toolbar a {
        color: var(--text-color);
        text-decoration: none;
        font-family: var(--font-stack);
        font-size: 14px;
        text-transform: uppercase;
    }

    
</style>

<div class="container">
    <header>
        <h1>QR</h1>
    </header>

    <div class="tabs">
        <button class="tab active" data-type="text">TEXT</button>
        <button class="tab" data-type="url">URL</button>
        <button class="tab" data-type="wifi">WIFI</button>
    </div>

    <div class="input-area">
        <textarea id="text-input" placeholder="ENTER TEXT..."></textarea>

        <div class="wifi-fields" id="wifi-fields">
            <input type="text" id="wifi-ssid" placeholder="NETWORK NAME (SSID)">
            <input type="password" id="wifi-pass" placeholder="PASSWORD">
            <select id="wifi-type">
                <option value="WPA">WPA/WPA2</option>
                <option value="WEP">WEP</option>
                <option value="nopass">NONE</option>
            </select>
        </div>
    </div>

    <div id="qr-container">
        <canvas id="qr" width="200" height="200"></canvas>
    </div>

    <div class="actions">
        <button id="download">DOWNLOAD</button>
        <button id="share">SHARE</button>
    </div>
</div>

<div class="toolbar">
    <a href="index.html">[HOME]</a>
</div>

<div class="toast" id="toast">LINK COPIED</div>

<script>
    let mode = 'text';
    const textInput = document.getElementById('text-input');
    const wifiFields = document.getElementById('wifi-fields');
    const canvas = document.getElementById('qr');
    const ctx = canvas.getContext('2d');
    const toast = document.getElementById('toast');

    document.querySelectorAll('.tab').forEach(t => t.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
        t.classList.add('active');
        mode = t.dataset.type;
        textInput.style.display = mode === 'wifi' ? 'none' : 'block';
        wifiFields.classList.toggle('active', mode === 'wifi');
        textInput.placeholder = mode === 'url' ? 'HTTPS://...' : 'ENTER TEXT...';
        generate();
    }));

    textInput.addEventListener('input', debounce(300, generate));
    document.getElementById('wifi-ssid').addEventListener('input', debounce(300, generate));
    document.getElementById('wifi-pass').addEventListener('input', debounce(300, generate));
    document.getElementById('wifi-type').addEventListener('change', generate);

    document.getElementById('download').addEventListener('click', () => {
        const a = document.createElement('a');
        a.download = 'qr-code.png';
        a.href = canvas.toDataURL('image/png');
        a.click();
    });

    document.getElementById('share').addEventListener('click', async () => {
        await save();
        try { await navigator.clipboard.writeText(location.href); showToast('LINK COPIED'); } catch { }
    });

    function getData() {
        if (mode === 'wifi') {
            const s = document.getElementById('wifi-ssid').value;
            const p = document.getElementById('wifi-pass').value;
            const t = document.getElementById('wifi-type').value;
            return `WIFI:T:${t};S:${s};P:${p};;`;
        }
        return textInput.value;
    }

    function generate() {
        const data = getData();
        if (!data) { ctx.clearRect(0, 0, 200, 200); return; }
        const qr = generateQR(data);
        drawQR(qr);
        save();
    }

    function generateQR(data) {
        const size = 21 + 4 * Math.min(Math.floor(data.length / 10), 20);
        const matrix = [];
        for (let i = 0; i < size; i++) { matrix[i] = []; for (let j = 0; j < size; j++) matrix[i][j] = 0; }

        addFinderPattern(matrix, 0, 0);
        addFinderPattern(matrix, size - 7, 0);
        addFinderPattern(matrix, 0, size - 7);

        for (let i = 0; i < 8; i++) for (let j = 0; j < 8; j++) {
            if (i < 7 && j < 7) continue;
            matrix[i][j] = 0;
            if (matrix[size - 8 + i]) matrix[size - 8 + i][j] = 0;
            matrix[i][size - 8 + j] = 0;
        }
        for (let i = 8; i < size - 8; i++) {
            matrix[6][i] = (i % 2 === 0) ? 1 : 0;
            matrix[i][6] = (i % 2 === 0) ? 1 : 0;
        }

        const bits = [];
        for (let i = 0; i < data.length; i++) {
            const c = data.charCodeAt(i);
            bits.push((c >> 7) & 1, (c >> 6) & 1, (c >> 5) & 1, (c >> 4) & 1, (c >> 3) & 1, (c >> 2) & 1, (c >> 1) & 1, c & 1);
        }

        let bi = 0;
        for (let col = size - 1; col > 0; col -= 2) {
            if (col === 6) col--;
            for (let row = 0; row < size; row++) {
                for (let c = 0; c < 2; c++) {
                    const x = col - c;
                    const y = (((col + 1) / 2 | 0) % 2 === 0) ? size - 1 - row : row;
                    if (matrix[y][x] === 0 && y >= 0 && y < size && x >= 0 && x < size) {
                        matrix[y][x] = bi < bits.length ? bits[bi++] : (Math.random() > 0.5 ? 1 : 0);
                    }
                }
            }
        }
        return matrix;
    }

    function addFinderPattern(m, x, y) {
        for (let i = 0; i < 7; i++) for (let j = 0; j < 7; j++) {
            const outer = i === 0 || i === 6 || j === 0 || j === 6;
            const inner = i >= 2 && i <= 4 && j >= 2 && j <= 4;
            m[y + i][x + j] = (outer || inner) ? 1 : 0;
        }
    }

    function drawQR(matrix) {
        const size = matrix.length;
        const cellSize = 200 / size;
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, 200, 200);
        ctx.fillStyle = 'black';
        for (let i = 0; i < size; i++) for (let j = 0; j < size; j++) {
            if (matrix[i][j]) ctx.fillRect(j * cellSize, i * cellSize, cellSize, cellSize);
        }
    }

    async function save() {
        const d = { mode, text: textInput.value, ssid: document.getElementById('wifi-ssid').value, pass: document.getElementById('wifi-pass').value, type: document.getElementById('wifi-type').value };
        const h = await compress(JSON.stringify(d));
        history.replaceState({}, '', '#' + h);
        try { localStorage.setItem('qr-hash', h); } catch { }
    }

    async function load() {
        try {
            let h = location.hash.slice(1);
            if (!h) h = localStorage.getItem('qr-hash');
            if (h) {
                const d = JSON.parse(await decompress(h));
                mode = d.mode || 'text';
                textInput.value = d.text || '';
                document.getElementById('wifi-ssid').value = d.ssid || '';
                document.getElementById('wifi-pass').value = d.pass || '';
                document.getElementById('wifi-type').value = d.type || 'WPA';
                document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.type === mode));
                textInput.style.display = mode === 'wifi' ? 'none' : 'block';
                wifiFields.classList.toggle('active', mode === 'wifi');
            }
        } catch { }
        generate();
    }

    async function compress(s) { const b = new TextEncoder().encode(s), st = new CompressionStream('deflate-raw'), w = st.writable.getWriter(); w.write(b); w.close(); return btoa(String.fromCharCode(...new Uint8Array(await new Response(st.readable).arrayBuffer()))).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, ''); }
    async function decompress(b) { const bin = atob(b.replace(/-/g, '+').replace(/_/g, '/')), arr = Uint8Array.from(bin, c => c.charCodeAt(0)), st = new DecompressionStream('deflate-raw'), w = st.writable.getWriter(); w.write(arr); w.close(); return new TextDecoder().decode(await new Response(st.readable).arrayBuffer()); }
    function debounce(ms, fn) { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), ms); }; }
    function showToast(m) { toast.textContent = m; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 2000); }

    addEventListener('DOMContentLoaded', load);
</script>
