<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>PDOS 01</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      padding: 20px;
      align-items: center;
    }

    header {
      margin-bottom: 40px;
      padding-bottom: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }

    .logo {
      width: 80px;
      height: 80px;
      fill: var(--text-color);
    }

    .subtitle {
      font-size: 12px;
      opacity: 0.7;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    footer {
      margin-top: 60px;
      font-size: 10px;
      text-transform: uppercase;
      opacity: 0.5;
      text-align: center;
      width: 100%;
      border-top: 1px solid var(--border-color);
      padding-top: 20px;
    }
  </style>
  <link rel="manifest" href="manifest.json">
</head>

<body>

  <div class="matrix-overlay"></div>

  <div class="container">
    <header>
      <svg class="logo" viewBox="0 0 200 250" xmlns="http://www.w3.org/2000/svg">
        <path fill="currentColor"
          d="M23.7,-34.6C34.4,-34.8,49.4,-36,53.2,-30.4C57,-24.8,49.5,-12.4,41.3,-4.7C33.2,3,24.4,6,18.2,7.4C12.1,8.8,8.5,8.6,5.9,8C3.2,7.4,1.6,6.4,-2.7,11.1C-7.1,15.8,-14.1,26.3,-14.2,25.4C-14.3,24.6,-7.5,12.5,-17.5,6.3C-27.5,0.2,-54.3,0.1,-55.5,-0.7C-56.7,-1.5,-32.2,-2.9,-19.9,-5.2C-7.7,-7.4,-7.6,-10.3,-6.4,-15.5C-5.1,-20.8,-2.5,-28.3,2,-31.7C6.5,-35.1,13,-34.4,23.7,-34.6Z"
          transform="translate(100 100) scale(2)" />
      </svg>
      <h1>PDOS 01</h1>
      <div class="subtitle">POST DISASTER OPERATIVE SYSTEM</div>
      <input type="text" id="appSearch" placeholder="SEARCH APPS..."
        style="background: transparent; border: none; border-bottom: 1px solid var(--border-color); width: 200px; text-align: center; color: var(--text-color); font-family: inherit; font-size: 12px; padding: 8px; outline: none; text-transform: uppercase;">
    </header>

    <div class="grid">
      <!-- Essential -->
      <a href="calendar.html" class="card">
        <div class="card-name">CALENDAR</div>
        <div class="card-desc">PLANNER</div>
      </a>
      <a href="contacts.html" class="card">
        <div class="card-name">CONTACTS</div>
        <div class="card-desc">DIRECTORY</div>
      </a>
      <a href="chat.html" class="card">
        <div class="card-name">CHAT</div>
        <div class="card-desc">ROOMS</div>
      </a>
      <a href="sms.html" class="card">
        <div class="card-name">SMS</div>
        <div class="card-desc">PRIVATE</div>
      </a>
      <a href="pass.html" class="card">
        <div class="card-name">PASS</div>
        <div class="card-desc">VAULT</div>
      </a>

      <a href="calc.html" class="card">
        <div class="card-name">CALC</div>
        <div class="card-desc">MATH</div>
      </a>
      <a href="alarm.html" class="card">
        <div class="card-name">ALARM</div>
        <div class="card-desc">WAKE UP</div>
      </a>
      <a href="timer.html" class="card">
        <div class="card-name">TIMER</div>
        <div class="card-desc">CHRONO</div>
      </a>
      <a href="clock.html" class="card">
        <div class="card-name">CLOCK</div>
        <div class="card-desc">TIME</div>
      </a>
      <a href="weather.html" class="card">
        <div class="card-name">WEATHER</div>
        <div class="card-desc">FORECAST</div>
      </a>

      <!-- Utilities -->
      <a href="notes.html" class="card">
        <div class="card-name">NOTES</div>
        <div class="card-desc">MULTI</div>
      </a>
      <a href="pad.html" class="card">
        <div class="card-name">PAD</div>
        <div class="card-desc">QUICK</div>
      </a>
      <a href="list.html" class="card">
        <div class="card-name">LIST</div>
        <div class="card-desc">TASKS</div>
      </a>
      <a href="split.html" class="card">
        <div class="card-name">SPLIT</div>
        <div class="card-desc">FINANCE</div>
      </a>
      <a href="where.html" class="card">
        <div class="card-name">WHERE</div>
        <div class="card-desc">GPS</div>
      </a>
      <a href="qr.html" class="card">
        <div class="card-name">QR</div>
        <div class="card-desc">SCAN</div>
      </a>

      <!-- Health & Lifestyle -->
      <a href="moon.html" class="card">
        <div class="card-name">MOON</div>
        <div class="card-desc">PHASE</div>
      </a>
      <a href="water.html" class="card">
        <div class="card-name">H‚ÇÇO</div>
        <div class="card-desc">HYDRATE</div>
      </a>
      <a href="breathe.html" class="card">
        <div class="card-name">BREATHE</div>
        <div class="card-desc">RELAX</div>
      </a>
      <a href="money.html" class="card">
        <div class="card-name">MONEY</div>
        <div class="card-desc">FINANCE</div>
      </a>
      <a href="stocks.html" class="card">
        <div class="card-name">STOCKS</div>
        <div class="card-desc">CRYPTO</div>
      </a>
      <a href="news.html" class="card">
        <div class="card-name">NEWS</div>
        <div class="card-desc">RSS</div>
      </a>

      <!-- Misc -->
      <a href="chess.html" class="card">
        <div class="card-name">CHESS</div>
        <div class="card-desc">GAME</div>
      </a>
      <a href="dino.html" class="card">
        <div class="card-name">DINO</div>
        <div class="card-desc">RUNNER</div>
      </a>
      <a href="battle.html" class="card">
        <div class="card-name">BATTLE</div>
        <div class="card-desc">RPG</div>
      </a>

      <!-- Productivity -->
      <a href="habit.html" class="card">
        <div class="card-name">HABIT</div>
        <div class="card-desc">TRACK</div>
      </a>
      <a href="kanban.html" class="card">
        <div class="card-name">KANBAN</div>
        <div class="card-desc">BOARD</div>
      </a>

      <a href="drive.html" class="card">
        <div class="card-name">DRIVE</div>
        <div class="card-desc">FILES</div>
      </a>
      <a href="amp.html" class="card">
        <div class="card-name">AMP</div>
        <div class="card-desc">MUSIC</div>
      </a>
      <a href="pic.html" class="card">
        <div class="card-name">PIC</div>
        <div class="card-desc">IMAGE</div>
      </a>
      <a href="poll.html" class="card">
        <div class="card-name">POLL</div>
        <div class="card-desc">VOTE</div>
      </a>
      <a href="wheel.html" class="card">
        <div class="card-name">WHEEL</div>
        <div class="card-desc">RNG</div>
      </a>
      <a href="snippet.html" class="card">
        <div class="card-name">CODE</div>
        <div class="card-desc">DEV</div>
      </a>
      <a href="secret.html" class="card">
        <div class="card-name">SECRET</div>
        <div class="card-desc">CRYPT</div>
      </a>
      <a href="collect.html" class="card">
        <div class="card-name">COLLECT</div>
        <div class="card-desc">LINKS</div>
      </a>
    </div>

    <footer style="display:flex; flex-direction:column; gap:12px;">
      <div id="auth-status" style="display:flex; gap:8px; align-items:center; justify-content:center;">
        <span id="user-display" style="font-size:12px; opacity:0.7;">NOT LOGGED IN</span>
        <button id="auth-btn" class="footer-btn">LOGIN</button>
      </div>
      <div style="display:flex; gap:8px; align-items:center; justify-content:center;">
        <span style="font-size:10px; opacity:0.5;">SYNC SERVER:</span>
        <input id="gun-url" type="text" placeholder="http://localhost:4000/gun"
          style="background:transparent; border:none; border-bottom:1px solid currentColor; color:inherit; font-family:inherit; font-size:10px; width:180px; text-transform:lowercase; text-align:center; opacity:0.7;">
      </div>
      <div style="display:flex; gap:8px; align-items:center; justify-content:center; flex-wrap:wrap;">
        <button id="theme-toggle" class="footer-btn">‚òÄ LIGHT</button>
        <button id="export-btn" class="footer-btn">‚Üì EXPORT</button>
        <button id="import-btn" class="footer-btn">‚Üë IMPORT</button>
        <button id="install-btn" class="footer-btn install-btn" style="display:none;">‚¨á INSTALL</button>
      </div>
      <div style="display:flex; gap:8px; align-items:center; justify-content:center; flex-wrap:wrap;">
        <button id="export-pair-btn" class="footer-btn">üîë EXPORT KEY</button>
        <button id="import-pair-btn" class="footer-btn">üîê IMPORT KEY</button>
      </div>
      <input type="file" id="import-file" accept=".json" style="display:none;">
      <div style="display:flex; gap:16px; align-items:center; justify-content:center;">
        <button id="about-btn" class="footer-link">ABOUT</button>
        <button id="selfhost-btn" class="footer-link">SELF HOST</button>
        <a href="https://shogun-eco.xyz" target="_blank" class="footer-link">SHOGUN-ECO.XYZ</a>
      </div>
    </footer>
  </div>

  <!-- About Modal -->
  <div id="about-modal"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:1000; align-items:center; justify-content:center; overflow-y:auto;">
    <div style="background:#000; border:1px solid #fff; padding:32px; width:90%; max-width:480px; margin:20px auto;">
      <h3 style="text-transform:uppercase; font-size:16px; margin-bottom:24px; text-align:center; letter-spacing:2px;">
        ABOUT PDOS 01</h3>

      <div style="font-size:13px; line-height:1.8; opacity:0.9;">
        <p style="margin-bottom:16px;">
          <strong>PDOS 01</strong> is a <strong>privacy-first</strong> toolkit that works without centralized servers.
        </p>

        <p style="margin-bottom:16px;">
          üì± <strong>Your data stays yours</strong><br>
          Data is stored locally on your device. No tracking, no ads, no mandatory accounts.
        </p>

        <p style="margin-bottom:16px;">
          üîê <strong>Identity & Sync</strong><br>
          Create an optional account to sync across devices using Gun's user space. Your identity is cryptographically
          secured.
        </p>

        <p style="margin-bottom:16px;">
          üîó <strong>URL Compression</strong><br>
          Share data instantly via compressed URLs. State is encoded directly in the link - no server needed.
        </p>

        <p style="margin-bottom:16px;">
          üõ†Ô∏è <strong>Included tools</strong><br>
          Calendar, contacts, chat, password manager, notes, calculator, timer, QR scanner, polls and
          more.
        </p>

        <p style="margin-bottom:20px; opacity:0.7; font-size:11px;">
          Open source project, part of the Shogun ecosystem.<br>
          Built with ‚ù§Ô∏è for the community.
        </p>
      </div>

      <button id="about-close"
        style="width:100%; background:#fff; border:1px solid #fff; color:#000; font-family:inherit; padding:14px; cursor:pointer; text-transform:uppercase; font-weight:bold;">CLOSE</button>
    </div>
  </div>

  <!-- Self Host Modal -->
  <div id="selfhost-modal"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:1000; align-items:center; justify-content:center; overflow-y:auto;">
    <div style="background:#000; border:1px solid #fff; padding:32px; width:90%; max-width:520px; margin:20px auto;">
      <h3 style="text-transform:uppercase; font-size:16px; margin-bottom:24px; text-align:center; letter-spacing:2px;">
        SELF HOSTING</h3>

      <div style="font-size:12px; line-height:1.7; opacity:0.9;">
        <p style="margin-bottom:16px;">
          Run your own instance of PDOS 01. Choose your preferred method:
        </p>

        <div style="margin-bottom:20px;">
          <p style="margin-bottom:8px;"><strong>üê≥ Docker</strong></p>
          <code
            style="display:block; background:#111; padding:12px; font-size:11px; overflow-x:auto; border:1px solid #333;">docker run -p 4000:4000 ghcr.io/scobru/shogun-nobackend</code>
        </div>

        <div style="margin-bottom:20px;">
          <p style="margin-bottom:8px;"><strong>üì¶ Docker Compose</strong></p>
          <code
            style="display:block; background:#111; padding:12px; font-size:11px; overflow-x:auto; border:1px solid #333;">git clone https://github.com/scobru/shogun-nobackend<br>cd shogun-nobackend<br>docker-compose up -d</code>
        </div>

        <div style="margin-bottom:20px;">
          <p style="margin-bottom:8px;"><strong>üìÅ npm / yarn</strong></p>
          <code
            style="display:block; background:#111; padding:12px; font-size:11px; overflow-x:auto; border:1px solid #333;">git clone https://github.com/scobru/shogun-nobackend<br>cd shogun-nobackend<br>yarn install<br>yarn start</code>
        </div>

        <div style="margin-bottom:20px;">
          <p style="margin-bottom:8px;"><strong>‚ñ≤ Vercel / Netlify</strong></p>
          <p style="opacity:0.7; font-size:11px;">Deploy directly from GitHub. Static files only, no server needed for
            basic usage.</p>
        </div>

        <p style="opacity:0.5; font-size:10px; margin-bottom:16px;">
          Default port: 4000 ‚Ä¢ Sync requires a Gun relay server
        </p>
      </div>

      <button id="selfhost-close"
        style="width:100%; background:#fff; border:1px solid #fff; color:#000; font-family:inherit; padding:14px; cursor:pointer; text-transform:uppercase; font-weight:bold;">CLOSE</button>
    </div>
  </div>

  <!-- Auth Modal -->
  <div id="auth-modal"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:1000; align-items:center; justify-content:center;">
    <div style="background:#000; border:1px solid #fff; padding:24px; width:90%; max-width:320px;">
      <h3 id="auth-title" style="text-transform:uppercase; font-size:14px; margin-bottom:20px; text-align:center;">LOGIN
      </h3>
      <input id="auth-user" type="text" placeholder="USERNAME"
        style="width:100%; background:transparent; border:1px solid #fff; color:#fff; font-family:inherit; padding:12px; margin-bottom:12px;">
      <input id="auth-pass" type="password" placeholder="PASSWORD"
        style="width:100%; background:transparent; border:1px solid #fff; color:#fff; font-family:inherit; padding:12px; margin-bottom:20px;">
      <div style="display:flex; gap:12px;">
        <button id="auth-cancel"
          style="flex:1; background:transparent; border:1px solid #fff; color:#fff; font-family:inherit; padding:12px; cursor:pointer; text-transform:uppercase;">CANCEL</button>
        <button id="auth-submit"
          style="flex:1; background:#fff; border:1px solid #fff; color:#000; font-family:inherit; padding:12px; cursor:pointer; text-transform:uppercase; font-weight:bold;">LOGIN</button>
      </div>
      <button id="auth-toggle"
        style="width:100%; margin-top:12px; background:transparent; border:none; color:#fff; font-family:inherit; padding:8px; cursor:pointer; opacity:0.5; font-size:10px;">NO
        ACCOUNT? REGISTER</button>
    </div>
  </div>

  <!-- Import Keypair Modal -->
  <div id="import-pair-modal"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:1000; align-items:center; justify-content:center;">
    <div style="background:#000; border:1px solid #fff; padding:24px; width:90%; max-width:400px;">
      <h3 style="text-transform:uppercase; font-size:14px; margin-bottom:20px; text-align:center;">üîê IMPORT KEYPAIR
      </h3>
      <p style="font-size:11px; opacity:0.6; margin-bottom:16px; line-height:1.5;">Paste your exported keypair JSON to
        login with your existing identity.</p>
      <textarea id="import-pair-input" placeholder="Paste keypair JSON here..."
        style="width:100%; height:150px; background:transparent; border:1px solid #fff; color:#fff; font-family:inherit; padding:12px; margin-bottom:16px; resize:none; font-size:11px;"></textarea>
      <div style="display:flex; gap:12px;">
        <button id="import-pair-cancel"
          style="flex:1; background:transparent; border:1px solid #fff; color:#fff; font-family:inherit; padding:12px; cursor:pointer; text-transform:uppercase;">CANCEL</button>
        <button id="import-pair-submit"
          style="flex:1; background:#fff; border:1px solid #fff; color:#000; font-family:inherit; padding:12px; cursor:pointer; text-transform:uppercase; font-weight:bold;">IMPORT
          & LOGIN</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
  <script>
    // Elements
    const gunUrlInput = document.getElementById('gun-url');
    const userDisplay = document.getElementById('user-display');
    const authBtn = document.getElementById('auth-btn');
    const authModal = document.getElementById('auth-modal');
    const authTitle = document.getElementById('auth-title');
    const authUser = document.getElementById('auth-user');
    const authPass = document.getElementById('auth-pass');
    const authSubmit = document.getElementById('auth-submit');
    const authToggle = document.getElementById('auth-toggle');
    const aboutBtn = document.getElementById('about-btn');
    const aboutModal = document.getElementById('about-modal');
    const aboutClose = document.getElementById('about-close');
    const selfhostBtn = document.getElementById('selfhost-btn');
    const selfhostModal = document.getElementById('selfhost-modal');
    const selfhostClose = document.getElementById('selfhost-close');
    const defaultUrl = 'http://localhost:4000/gun';
    let isLogin = true;
    let gun, user;

    // About modal handlers
    aboutBtn.addEventListener('click', () => {
      aboutModal.style.display = 'flex';
    });
    aboutClose.addEventListener('click', () => {
      aboutModal.style.display = 'none';
    });
    aboutModal.addEventListener('click', (e) => {
      if (e.target === aboutModal) aboutModal.style.display = 'none';
    });

    // Self Host modal handlers
    selfhostBtn.addEventListener('click', () => {
      selfhostModal.style.display = 'flex';
    });
    selfhostClose.addEventListener('click', () => {
      selfhostModal.style.display = 'none';
    });
    selfhostModal.addEventListener('click', (e) => {
      if (e.target === selfhostModal) selfhostModal.style.display = 'none';
    });

    // Ensure relay URL in localStorage
    if (!localStorage.getItem('gun-relay-url')) {
      localStorage.setItem('gun-relay-url', defaultUrl);
    }
    gunUrlInput.value = localStorage.getItem('gun-relay-url');

    // Initialize Gun
    gun = Gun({ localStorage: false, peers: [localStorage.getItem('gun-relay-url')] });
    user = gun.user().recall({ sessionStorage: true });

    // Check if already logged in
    gun.on('auth', () => {
      const alias = user.is?.alias || 'USER';
      userDisplay.textContent = alias.toUpperCase();
      authBtn.textContent = 'LOGOUT';
      localStorage.setItem('gun-user-alias', alias);
    });

    // ==================== KEYPAIR EXPORT/IMPORT ====================
    const exportPairBtn = document.getElementById('export-pair-btn');
    const importPairBtn = document.getElementById('import-pair-btn');
    const importPairModal = document.getElementById('import-pair-modal');
    const importPairInput = document.getElementById('import-pair-input');
    const importPairSubmit = document.getElementById('import-pair-submit');
    const importPairCancel = document.getElementById('import-pair-cancel');

    // Export keypair
    exportPairBtn.addEventListener('click', async () => {
      if (!user.is) {
        alert('You must be logged in to export your keypair');
        return;
      }

      const pair = user._.sea;
      if (!pair) {
        alert('No keypair found');
        return;
      }

      const exportData = {
        pub: pair.pub,
        priv: pair.priv,
        epub: pair.epub,
        epriv: pair.epriv,
        alias: user.is.alias,
        exportedAt: new Date().toISOString()
      };

      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `pdos-01-keypair-${user.is.alias}-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);

      alert('‚ö†Ô∏è Keep this file safe! Anyone with this keypair can access your account.');
    });

    // Show import modal
    importPairBtn.addEventListener('click', () => {
      if (user.is) {
        alert('Please logout first before importing a new keypair');
        return;
      }
      importPairModal.style.display = 'flex';
      importPairInput.focus();
    });

    // Cancel import
    importPairCancel.addEventListener('click', () => {
      importPairModal.style.display = 'none';
      importPairInput.value = '';
    });

    // Import and login with keypair
    importPairSubmit.addEventListener('click', async () => {
      const jsonStr = importPairInput.value.trim();
      if (!jsonStr) {
        alert('Please paste a keypair JSON');
        return;
      }

      try {
        const pair = JSON.parse(jsonStr);

        // Validate keypair structure
        if (!pair.pub || !pair.priv || !pair.epub || !pair.epriv) {
          throw new Error('Invalid keypair: missing required fields (pub, priv, epub, epriv)');
        }

        importPairSubmit.textContent = 'IMPORTING...';
        importPairSubmit.disabled = true;

        // Authenticate with the imported keypair
        user.auth(pair, (ack) => {
          if (ack.err) {
            alert('Import failed: ' + ack.err);
            importPairSubmit.textContent = 'IMPORT & LOGIN';
            importPairSubmit.disabled = false;
          } else {
            importPairModal.style.display = 'none';
            importPairInput.value = '';
            importPairSubmit.textContent = 'IMPORT & LOGIN';
            importPairSubmit.disabled = false;

            // Update UI
            const alias = pair.alias || 'USER';
            userDisplay.textContent = alias.toUpperCase();
            authBtn.textContent = 'LOGOUT';
            localStorage.setItem('gun-user-alias', alias);

            alert('Successfully imported and logged in!');
          }
        });
      } catch (e) {
        alert('Invalid JSON: ' + e.message);
      }
    });

    // Close import modal on overlay click
    importPairModal.addEventListener('click', (e) => {
      if (e.target === importPairModal) {
        importPairModal.style.display = 'none';
        importPairInput.value = '';
      }
    });

    // URL input handler
    gunUrlInput.addEventListener('change', (e) => {
      const url = e.target.value.trim() || defaultUrl;
      localStorage.setItem('gun-relay-url', url);
      gunUrlInput.value = url;
      gunUrlInput.style.color = '#22c55e';
      setTimeout(() => gunUrlInput.style.color = '#fff', 1000);
    });

    // Auth button
    authBtn.addEventListener('click', () => {
      if (user.is) {
        // Logout
        user.leave();
        userDisplay.textContent = 'NOT LOGGED IN';
        authBtn.textContent = 'LOGIN';
        localStorage.removeItem('gun-user-alias');
      } else {
        // Show login modal
        authModal.style.display = 'flex';
        authUser.focus();
      }
    });

    // Toggle login/register
    authToggle.addEventListener('click', () => {
      isLogin = !isLogin;
      authTitle.textContent = isLogin ? 'LOGIN' : 'REGISTER';
      authSubmit.textContent = isLogin ? 'LOGIN' : 'REGISTER';
      authToggle.textContent = isLogin ? 'NO ACCOUNT? REGISTER' : 'HAVE ACCOUNT? LOGIN';
    });

    // Cancel
    document.getElementById('auth-cancel').addEventListener('click', () => {
      authModal.style.display = 'none';
      authUser.value = '';
      authPass.value = '';
    });

    // Submit auth
    authSubmit.addEventListener('click', async () => {
      const username = authUser.value.trim();
      const password = authPass.value;
      if (!username || !password) return;

      authSubmit.textContent = 'PLEASE WAIT...';
      authSubmit.disabled = true;

      if (isLogin) {
        user.auth(username, password, (ack) => {
          if (ack.err) {
            alert('LOGIN FAILED: ' + ack.err);
            authSubmit.textContent = 'LOGIN';
            authSubmit.disabled = false;
          } else {
            authModal.style.display = 'none';
            authUser.value = '';
            authPass.value = '';
            authSubmit.textContent = 'LOGIN';
            authSubmit.disabled = false;
          }
        });
      } else {
        user.create(username, password, (ack) => {
          if (ack.err) {
            alert('REGISTER FAILED: ' + ack.err);
            authSubmit.textContent = 'REGISTER';
            authSubmit.disabled = false;
          } else {
            // Auto login after register
            user.auth(username, password, () => {
              authModal.style.display = 'none';
              authUser.value = '';
              authPass.value = '';
              authSubmit.textContent = 'LOGIN';
              authSubmit.disabled = false;
            });
          }
        });
      }
    });

    // Enter key to submit
    authPass.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') authSubmit.click();
    });

    // ==================== SERVICE WORKER ====================
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js')
        .then(reg => console.log('[SW] Registered:', reg.scope))
        .catch(err => console.log('[SW] Registration failed:', err));
    }

    // ==================== PWA INSTALL ====================
    let deferredPrompt;
    const installBtn = document.getElementById('install-btn');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'inline-block';
    });

    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      console.log('[PWA] Install outcome:', outcome);
      deferredPrompt = null;
      installBtn.style.display = 'none';
    });

    // ==================== THEME TOGGLE ====================
    const themeToggle = document.getElementById('theme-toggle');

    function applyTheme(isLight) {
      if (isLight) {
        document.body.classList.add('light-theme');
        themeToggle.textContent = 'üåô DARK';
      } else {
        document.body.classList.remove('light-theme');
        themeToggle.textContent = '‚òÄ LIGHT';
      }
    }

    // Load saved theme
    const savedTheme = localStorage.getItem('shogun-theme');
    applyTheme(savedTheme === 'light');

    themeToggle.addEventListener('click', () => {
      const isLight = !document.body.classList.contains('light-theme');
      applyTheme(isLight);
      localStorage.setItem('shogun-theme', isLight ? 'light' : 'dark');
    });

    // ==================== EXPORT / IMPORT ====================
    const exportBtn = document.getElementById('export-btn');
    const importBtn = document.getElementById('import-btn');
    const importFile = document.getElementById('import-file');

    // Export all localStorage data
    exportBtn.addEventListener('click', () => {
      const data = {};
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        data[key] = localStorage.getItem(key);
      }

      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `pdos-01-backup-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
    });

    // Import from file
    importBtn.addEventListener('click', () => importFile.click());

    importFile.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (event) => {
        try {
          const data = JSON.parse(event.target.result);
          let count = 0;
          for (const [key, value] of Object.entries(data)) {
            localStorage.setItem(key, value);
            count++;
          }
          alert(`Imported ${count} items successfully! Refresh to apply.`);
        } catch (err) {
          alert('Import failed: Invalid JSON file');
        }
      };
      reader.readAsText(file);
      importFile.value = ''; // Reset
    });

    // ==================== APP SEARCH ====================
    const appSearch = document.getElementById('appSearch');
    const cards = document.querySelectorAll('.card');

    if (appSearch) {
      appSearch.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase().trim();

        cards.forEach(card => {
          const name = card.querySelector('.card-name').textContent.toLowerCase();
          const desc = card.querySelector('.card-desc').textContent.toLowerCase();

          if (name.includes(term) || desc.includes(term)) {
            card.style.display = 'flex';
          } else {
            card.style.display = 'none';
          }
        });
      });
    }
  </script>