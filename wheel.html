<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>WHEEL</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
<style>
    body {
        padding: 20px;
        padding-bottom: 100px;
        
        align-items: center;
    }

    .container {
        width: 100%;
        max-width: 500px;
    }

    header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 20px;
    }.wheel-container {
        position: relative;
        margin-bottom: 24px;
        display: flex;
        justify-content: center;
    }

    canvas {
        border: 1px solid var(--border-color);
        border-radius: 50%;
    }

    .pointer {
        position: absolute;
        top: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-top: 20px solid var(--accent-color);
        z-index: 10;
    }

    .result {
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        min-height: 40px;
        margin-bottom: 24px;
        color: var(--accent-color);
        text-transform: uppercase;
    }

    .card {
        border: 1px solid var(--border-color);
        padding: 20px;
        margin-bottom: 20px;
    }

    h2 {
        font-size: 14px;
        text-transform: uppercase;
        margin-bottom: 16px;
        border-bottom: 1px dashed var(--border-color);
        padding-bottom: 8px;
    }

    .option {
        display: flex;
        gap: 8px;
        margin-bottom: 8px;
    }

    input {
        flex: 1;
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-color);
        font-family: var(--font-stack);
        padding: 8px;
        outline: none;
    }

    input:focus {
        border-color: var(--accent-color);
    }

    .del-btn {
        padding: 8px 12px;
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-color);
        cursor: pointer;
    }

    .add-btn {
        width: 100%;
        padding: 10px;
        border: 1px dashed var(--border-color);
        background: transparent;
        color: var(--text-color);
        font-family: var(--font-stack);
        cursor: pointer;
        text-transform: uppercase;
        margin-top: 8px;
    }

    .add-btn:hover {
        background: #111;
    }

    .spin-btn {
        width: 100%;
        padding: 16px;
        background: var(--text-color);
        border: 1px solid var(--text-color);
        color: var(--bg-color);
        font-family: var(--font-stack);
        text-transform: uppercase;
        cursor: pointer;
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 16px;
    }

    .spin-btn:hover {
        background: var(--bg-color);
        color: var(--text-color);
    }

    .spin-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .actions {
        display: flex;
        gap: 16px;
    }

    .action-btn {
        flex: 1;
        padding: 12px;
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-color);
        font-family: var(--font-stack);
        text-transform: uppercase;
        cursor: pointer;
    }

    .action-btn:hover {
        background: var(--text-color);
        color: var(--bg-color);
    }

    /* Toolbar */
    .toolbar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: var(--bg-color);
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: space-around;
        padding: 16px;
    }

    .toolbar a {
        color: var(--text-color);
        text-decoration: none;
        font-family: var(--font-stack);
        font-size: 14px;
        text-transform: uppercase;
    }

    
</style>

<div class="container">
    <header>
        <h1>WHEEL</h1>
    </header>

    <div class="wheel-container">
        <div class="pointer"></div>
        <canvas id="wheel" width="300" height="300"></canvas>
    </div>

    <div class="result" id="result"></div>

    <button class="spin-btn" id="spin">SPIN</button>

    <div class="card">
        <h2>OPTIONS</h2>
        <div id="options"></div>
        <button class="add-btn" id="add">+ ADD OPTION</button>
    </div>

    <div class="actions">
        <button class="action-btn" id="reset">RESET</button>
        <button class="action-btn" id="share">SHARE</button>
    </div>
</div>

<div class="toolbar">
    <a href="index.html">[HOME]</a>
</div>

<div class="toast" id="toast">LINK COPIED</div>

<script>
    const COLORS = ['#111111', '#333333', '#555555', '#777777', '#999999', '#bbbbbb'];
    let options = ['PIZZA', 'SUSHI', 'BURGER', 'PASTA', 'TACOS'];
    let rotation = 0, spinning = false;

    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const resultEl = document.getElementById('result');
    const toast = document.getElementById('toast');

    document.getElementById('spin').addEventListener('click', spin);
    document.getElementById('add').addEventListener('click', () => {
        options.push(`OPTION ${options.length + 1}`);
        render(); save();
    });
    document.getElementById('reset').addEventListener('click', () => {
        options = ['PIZZA', 'SUSHI', 'BURGER', 'PASTA', 'TACOS'];
        render(); save();
    });
    document.getElementById('share').addEventListener('click', async () => {
        await save();
        try { await navigator.clipboard.writeText(location.href); showToast('LINK COPIED'); } catch { }
    });

    window.updateOption = (i, val) => { options[i] = val.toUpperCase(); drawWheel(); save(); };
    window.removeOption = (i) => { if (options.length > 2) { options.splice(i, 1); render(); save(); } };

    function render() {
        const el = document.getElementById('options');
        el.innerHTML = options.map((o, i) => `
      <div class="option">
        <input value="${o}" onchange="updateOption(${i},this.value)">
        <button class="del-btn" onclick="removeOption(${i})">X</button>
      </div>
    `).join('');
        drawWheel();
    }

    function drawWheel() {
        const n = options.length, arc = 2 * Math.PI / n, r = 150;
        ctx.clearRect(0, 0, 300, 300);

        options.forEach((opt, i) => {
            ctx.beginPath();
            ctx.moveTo(r, r);
            ctx.arc(r, r, r, rotation + i * arc, rotation + (i + 1) * arc);
            ctx.fillStyle = COLORS[i % COLORS.length];
            ctx.fill();
            ctx.strokeStyle = '#000';
            ctx.stroke();

            ctx.save();
            ctx.translate(r, r);
            ctx.rotate(rotation + i * arc + arc / 2);
            ctx.textAlign = 'right';
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 14px "Courier New"';
            ctx.fillText(opt, r - 10, 5);
            ctx.restore();
        });
    }

    function spin() {
        if (spinning || options.length < 2) return;
        spinning = true; resultEl.textContent = '';
        document.getElementById('spin').disabled = true;

        const spins = 5 + Math.random() * 5;
        const target = rotation + spins * 2 * Math.PI;
        const start = performance.now();
        const duration = 4000;

        function animate(now) {
            const elapsed = now - start;
            const progress = Math.min(elapsed / duration, 1);
            const ease = 1 - Math.pow(1 - progress, 3);

            rotation = target - (target - rotation) * (1 - ease); // Simplify? No, standard lerp
            rotation = rotation + (target - rotation) * 0.1; // Simple easing

            drawWheel();

            if (progress < 1) {
                requestAnimationFrame(animate);
            } else {
                rotation = target % (2 * Math.PI);
                drawWheel();
                spinning = false;
                document.getElementById('spin').disabled = false;

                const arc = 2 * Math.PI / options.length;
                const index = Math.floor((2 * Math.PI - (rotation % (2 * Math.PI)) + Math.PI / 2) / arc) % options.length;
                // Logic for pointer at top (3pi/2) vs rotation. 
                // Pointer is at -pi/2 (top). 
                // Angle at top is (3*PI/2 - rotation)
                const angleAtTop = (1.5 * Math.PI - rotation + 2 * Math.PI) % (2 * Math.PI);
                const winIdx = Math.floor(angleAtTop / arc) % options.length;

                resultEl.textContent = options[winIdx];
            }
        }
        requestAnimationFrame(animate);
    }

    async function save() {
        const h = await compress(JSON.stringify(options));
        history.replaceState({}, '', '#' + h);
        try { localStorage.setItem('wheel-hash', h); } catch { }
    }

    async function load() {
        try {
            let h = location.hash.slice(1); if (!h) h = localStorage.getItem('wheel-hash');
            if (h) options = JSON.parse(await decompress(h));
        } catch { }
        render();
    }

    async function compress(s) { const b = new TextEncoder().encode(s), st = new CompressionStream('deflate-raw'), w = st.writable.getWriter(); w.write(b); w.close(); return btoa(String.fromCharCode(...new Uint8Array(await new Response(st.readable).arrayBuffer()))).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, ''); }
    async function decompress(b) { const bin = atob(b.replace(/-/g, '+').replace(/_/g, '/')), arr = Uint8Array.from(bin, c => c.charCodeAt(0)), st = new DecompressionStream('deflate-raw'), w = st.writable.getWriter(); w.write(arr); w.close(); return new TextDecoder().decode(await new Response(st.readable).arrayBuffer()); }
    function showToast(m) { toast.textContent = m; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 2000); }

    addEventListener('DOMContentLoaded', load);
</script>
